#!/usr/bin/bash
#
# Calculate the project variables and place shell lines
# on stdout to define them
# 
# project_vars [config file] [exports]
#
# config file : (optional) Path and name of the PLUGIN_CONFIG file to use.
#       If this is not given (or is empty), it will try to find it by looking
#       up the directory heirarchy
#
# exports : (optional) If present, the script will generate export statements 
#       as well.

cfg_file=$1
do_export=$2

if [ -z "$cfg_file" ]; then
    cfg_file="PLUGIN_CONFIG"
    for file in "${cfg_file}" "../${cfg_file}"
    do
        if [ -e "$file" ]; then
            cfg_file=$file
            break
        fi
    done

    if [ ! -f "${cfg_file}" ]; then
        echo "ERROR: Could not find CONFIG file"
        exit 1
    fi
elif [ ! -f "$cfg_file" ]; then
    echo "ERROR: file '${cfg_file}' does not exist."
    exit 1
fi

if [ "$do_export" ]; then
    EXP="export "
else
    EXP=""
fi

while read -r line
do
    echo "${EXP}${line}"
done < ${cfg_file}

# Create derived variable
source "${cfg_file}"

PROJ_LOWER=${SF_PROJECT,,}

echo "${EXP}SF_PROJ_LOWER=${PROJ_LOWER}";
